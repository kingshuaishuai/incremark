# 架构

## 整体架构

```
┌─────────────────────────────────────────────────────┐
│                  IncremarkContent                    │
│  (高级封装，处理 append/finalize)                     │
└─────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────┐
│                   useIncremark                       │
│  (状态管理，响应式封装)                               |
└─────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────┐
│                  IncremarkParser                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ 边界检测      │  │ AST         │  │ 定义        │  │
│  │ Boundary    │  │ Builder     │  │ Manager     │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────┐
│                 BlockTransformer                     │
│  (打字机效果，字符级增量渲染)                         |
│  ┌─────────────┐  ┌─────────────┐                   │
│  │ Plugins     │  │ Chunk       │                   │
│  │ System      │  │ Animation   │                   │
│  └─────────────┘  └─────────────┘                   │
└─────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────┐
│                    Renderer                          │
│  (框架特定组件)                                      |
└─────────────────────────────────────────────────────┘
```

## 内部结构

### IncremarkParser
- **BoundaryDetector**：识别 markdown 流中的稳定边界以提交 block。
- **AstBuilder**：从已提交的 token 构建抽象语法树 (AST)。
- **DefinitionManager / FootnoteManager**：管理跨 block 的引用和脚注。

### 性能优化
- **增量行解析**：仅解析新行，保留先前状态。
- **上下文缓存**：缓存解析器上下文以有效恢复解析。
- **AST 增量追加**：追加新的 AST 节点而无需重建整个树。
